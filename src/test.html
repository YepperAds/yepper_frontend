<!DOCTYPE html>
<html lang="en">
    <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>News Page with Ads</title>
    <style>
        * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        }

        body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        color: #333;
        }

        header {
        background-color: #333;
        color: #fff;
        padding: 15px;
        text-align: center;
        }

        nav {
        margin: 10px 0;
        text-align: center;
        }

        nav a {
        margin: 0 15px;
        color: #fff;
        text-decoration: none;
        font-weight: bold;
        }

        .container {
        display: flex;
        margin: 20px;
        }

        .main-content {
        flex: 2;
        margin-right: 20px;
        }

        .article {
        background-color: #fff;
        margin-bottom: 20px;
        padding: 20px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .article img {
        max-width: 100%;
        height: auto;
        margin-bottom: 10px;
        }

        .article p {
        line-height: 1.6;
        }

        /* Ad container styling */
        .ad-container {
        margin-bottom: 20px;
        padding: 10px;
        background-color: red;
        text-align: center;
        border: 1px solid #ccc;
        width: 100px;
        height: 200px;
        margin: 0 auto; /* Center the ad */
        }

        /* Ensure the ad (images, iframes, etc.) fits within the container */
        .ad-container img, 
        .ad-container iframe {
        width: 100%;    /* Ensures the ad fits container width */
        height: 100%;   /* Ensures the ad fits container height */
        object-fit: cover; /* Ensures the content fills the space without distorting */
        }

    </style>
    </head>
    <body>

    <header>
        <h1>Daily News</h1>
        <nav>
        <a href="#">Home</a>
        <a href="#">World</a>
        </nav>
    </header>

    <div class="container">
        <!-- Main Content -->
        <div class="main-content">
        <div class="article">
            <img src="https://via.placeholder.com/600x300" alt="News Image">
            <h2>Breaking News Headline</h2>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer nec odio. Praesent libero. Sed cursus ante dapibus diam.</p>
        </div>

        <div class="ad-container">
            <script>

                (function(){
                  const d=document,
                        _i="6783bf073c8431cf1d9f75f6",
                        _b="http://localhost:5000/api", // Make URL configurable
                        _t=5000;
            
                  const _l=()=>{
                    const c=d.createElement("div");
                    c.id=_i+"-ad";
                    c.style.width = "100%";
                    c.style.minHeight = "100px";
                    
                    let s=d.currentScript;
                    if(!s){
                      const scripts=d.getElementsByTagName("script");
                      for(let i=0;i<scripts.length;i++){
                        if(scripts[i].textContent.includes("6783bf073c8431cf1d9f75f6")){
                          s=scripts[i];
                          break;
                        }
                      }
                    }
                    
                    if(s&&s.parentNode){
                      s.parentNode.insertBefore(c,s);
                    }else{
                      d.body.appendChild(c);
                    }
                    c.innerHTML = '<div style="text-align: center; padding: 20px;">Loading ad...</div>';
                    
                    const l=d.createElement("script");
                    const r="y"+Math.random().toString(36).substr(2,9);
                    
                    window[r]=h=>{
                      if(!h||!h.html) {
                        c.innerHTML = '<div style="text-align: center; padding: 20px;">No ads available</div>';
                        return;
                      }
                      c.innerHTML=h.html;
                      const a=[...c.getElementsByClassName("ad-container")];
                      if(!a.length) {
                        c.innerHTML = '<div style="text-align: center; padding: 20px;">Error loading ads</div>';
                        return;
                      }
            
                      a.forEach(e=>e.style.display="none");
                      a[0].style.display="block";
                      
                      a.forEach(e=>{
                        const link=e.querySelector('a');
                        if(!link)return;
                        const i=link.dataset.adId;
                        
                        // Modified view tracking
                        const viewTracker = () => {
                          fetch(_b+"/ads/view/"+i, {
                            method: 'POST',
                            mode: 'cors',
                            credentials: 'omit'
                          }).catch(console.error);
                        };
                        
                        if(e.style.display !== "none") {
                          viewTracker();
                        }
                        
                        // Modified click tracking
                        link.onclick=ev=>{
                          ev.preventDefault();
                          fetch(_b+"/ads/click/"+i, {
                            method: 'POST',
                            mode: 'cors',
                            credentials: 'omit'
                          })
                          .then(() => window.open(link.href,'_blank'))
                          .catch(() => window.open(link.href,'_blank'));
                          return false;
                        };
                      });
            
                      if(a.length>1) {
                        let x=0;
                        setInterval(()=>{
                          a[x].style.display="none";
                          x=(x+1)%a.length;
                          a[x].style.display="block";
                          const link=a[x].querySelector('a');
                          if(link) {
                            const i=link.dataset.adId;
                            fetch(_b+"/ads/view/"+i, {
                              method: 'POST',
                              mode: 'cors',
                              credentials: 'omit'
                            }).catch(console.error);
                          }
                        },_t);
                      }
                      delete window[r];
                    };
                    
                    l.src=_b+"/ads/display?categoryId="+_i+"&callback="+r;
                    l.onerror = () => {
                      c.innerHTML = '<div style="text-align: center; padding: 20px;">Failed to load ad content</div>';
                    };
                    d.body.appendChild(l);
                  };
            
                  if(d.readyState==="loading"){
                    d.addEventListener("DOMContentLoaded",_l);
                  }else{
                    _l();
                  }
                })();
              
            </script>
        </div>

    </body>
</html>